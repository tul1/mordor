<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Test ColladaLoader</title>
</head>

<script src="js/jquery-2.1.4.min.js" type="text/javascript"></script>
<script src="js/three.min.js" type="text/javascript"></script>
<script src="js/loaders/ColladaLoader.js " type="text/javascript"></script>
<script src="js/controls/OrbitControls.js" type="text/javascript"></script>

<script src="js2/multiMesh.js"></script>
<body>

<body onkeydown="onKeyDown">

<div id="contenido">
    <div id="panel3d">
    </div>
</div>


<script>
var escena;
var tiempo;
var controls;
var cameraManual;
var camaraActual;
var renderer;

function initThreeJS()
{
	var cont=$("#contenido");
	var container = document.getElementById('panel3d');
	escena = new THREE.Scene();

	cameraManual = new THREE.PerspectiveCamera(fov = 35, cont.width()/ cont.height(), 1, 10000);
	cameraManual.position.x = 0;
	cameraManual.position.y = 90;
	cameraManual.position.z = 200;
	cameraManual.far = 10000;

	camaraActual=cameraManual;

	controls = new THREE.OrbitControls(cameraManual, container);
	controls.target.y = 2;
	controls.update();

	renderer = new THREE.WebGLRenderer();
	renderer.setSize(cont.width(), cont.height());
	//renderer.setClearColor(0x333333, 1);

	renderer.shadowMapEnabled = true;
	renderer.shadowMapSoft = true;

	renderer.shadowMapBias = 0.1;
	renderer.shadowMapWidth = 2048;
	renderer.shadowMapHeight = 2048;

	$( window ).resize(function() 
		{
			renderer.setSize(cont.width(), cont.height());
		});
	container.appendChild(renderer.domElement);

	var gridHelper = new THREE.GridHelper( 100, 10 );
	gridHelper.setColors(new THREE.Color(0.3,0.3,0.3),new THREE.Color(.1,.1,.1));
	escena.add( gridHelper );
}

function setupLights()
{
	var light = new THREE.AmbientLight( 0x888888 ); // soft white light
	escena.add( light );

	var pointlight1 = new THREE.PointLight( 0xffffdd, 3, 100 );
	pointlight1.position.set( 0, 0, 0 );
	escena.add( pointlight1 );   
}

var frame=0;

function render()
{
	requestAnimationFrame(render);
	renderer.render(escena, camaraActual);
	frame++;
}

this.onKeyDown=function(event)
{
	console.log("onKeyDown");
	if(event.keyCode == 67)
	{
		if (camaraActual==cam1) 
			camaraActual = cam2;
		else
			camaraActual = cam1;
	}
}



function init()
{
	// ruta a los DAE, ruta a las Texturas
	var m = new MultiMesh("models/","maps/");
	m.addGeometry("pizarron.dae");
	m.addTexture("pizarron.jpg");
	m.startLoad();

	var material={
		"pizarron":new THREE.MeshPhongMaterial({
		color: 0x888888,
		specular: 0xFFFFFF,
		shininess: 1,
		shading: THREE.SmoothShading,
		map: m.getTexture("pizarron.jpg")
		//side:THREE.DoubleSide
	})};


//TODO esto no anda, m.getGeometry("pizarron.dae") devuelve null
//	var pizarronMesh = new THREE.Mesh(m.getGeometry("pizarron.dae"),m.getTexture("pizarron.jpg"));
//	var pizarron = new THREE.Object3D();
//	pizarron.add(pizarronMesh);
//	escena.add(pizarron);
}


initThreeJS();
setupLights();
init();
render();
	

</script>

</body>
</html>
